```yaml lw-blog-meta
title: "C#与Unity入坑体验"
date: "2022-03-17"
brev: "做游戏好简单，好快乐"
tags: ["csharp", "游戏"]
```

## 背景

两个月没写博客，差不多意味着这两个月里我没有再探索什么新技术。（不过在现有技术中提升熟练度还是有的）

原因呢，一方面还是偷懒了，打不起精神来，另一方面也确实没有好的方向。

最近几个月里，我还尝试探索过Java，虽然我已经做好了心理预期并且努力尝试让自己去接受那一套东西，可是真的搭起Demo的那一刻，我依然还是感觉到了强烈的不适感。所以没有学到几个小时，我就放弃了。

再次放弃Java的话，那我在面向对象这一块依然有所欠缺。所以一直算是我的一个小小心病。

之前玩戴森球的时候，我被这款游戏的性能优化所折服。当任何一个玩过传统模拟经营类游戏的玩家，肯定都经历过各种卡顿的现象，然而，卡顿这个词语似乎根本就不存在于戴森球计划这款游戏里的字典里。所以我也一直对戴森球计划背后的编程实现抱有兴趣。

阅读了一些开发者的博客之后，我得知，它主要是用c#和Unity来做的。

之前多少也听过一些c#的安利，不过因为一直对微软那一套东西非常反感，所以从未想过去体验一下。这次在戴森球计划的强烈安利下，我一查，c#也是典型的面向对象程序语言，而且几乎就是仿照Java来抄的。

咦，这下我真的得学一下c#了。

## c#入坑体验

### 1.安装

首先，从IDE开始。直接在Jetbrains套装里找，嘿，果然有，叫 Rider 。

下载安装之后，在配置界面，直接可以安装c#(.NET)运行环境，非常的简便。（不过之前安装Python还是Node的时候我是有装过VS的，不知道对这次的简便有没有影响）

新建一个项目（solution），造出了一堆目录和文件。仔细看看只有一个 xxx.sIn 的项目配置文件，配置文件是文本格式（或者某种微软自定格式），看不懂。

再在这个项目里创建一个工程（Project），好家伙，在这个工程的目录里除了一个Main的代码文件之外，又有一个配置文件 xxx.csproj ，格式是xml，这一下子就有java那股味道了。

然后开始写代码。在初始化的 hello world 文件里，非常简洁地只有一行代码：

```cs
// See https://aka.ms/new-console-template for more information
Console.WriteLine("Hello, World!");
```

原来在最新的 .NET6 中，c#已经支持简化语法了，在写Main的时候可以直接在最外层写，不需要namespace, class, function 这样套好几层了。

这个语法糖给人的第一印象挺好的，不过这种糖是否会给代码规范造成麻烦，还有待观察。

### 2.面向对象

- 面向对象这一套东西，确实是一种新的认知世界的方式，这次完全沉浸进去之后，有了一些不一样又无法用言语表达的体验。
- 面向对象的语法也确实繁杂，写个类、方法总是要带一大堆前缀。
- 只允许单继承，对于一个面向对象的语言来说不支持多继承这让我非常意外。
- 运算符重载，不像python那样用魔法方法，而是用`operate`这个关键字，有点意思。
- 类属性支持 get/set 这种访问器语法（js也有），我觉得这个特性会是双刃剑，至少目前看到的`DateTime.Now`这个用法就非常非常变扭（没有括号）

### 3.语句和基础用法

- 函数返回值类型写在函数名前面，变量类型也写在变量名前面，（而go js python都是写在后面），这让我一时间分不清这是类型还是名字。
- `using`是引入包里所有名称，（相当于`import * from xx`），这一点我觉得是倒退，这会让我不知道到底当前命名空间里都有些啥，会不会不小心用到一个奇怪的东西。
  + 关于这一点我觉得js的`import {} from`是最好的解决方案
  + go的必须带包名的用法也不好，写起来有点麻烦
- `using`同时又承担了上下文管理器的功能（python中的`with`），两个完全不相关的功能用同一个关键字，很难受。
- `switch`语句仅支持常量值，而不能在case里写判断表达式，这限制了代码的表达力。（接近于根本没有switch的Python）
- 有大量的语法简化
  + 例如访问器可以简写为`xxx => xxxx`，
  + 例如创建对象可以少写一次类型`List<string> xxx = new()`，
  + 例如在类中访问属性不需要`this`关键字
- 函数指针/闭包 被称为『委托Delegate』，搞得好像什么特别的东西似的，很别扭
  + 支持`()=>{}`语法，好评
- 保留了c语言中的糟粕语法，例如`var a = b++`
- 正则表达式我感觉好像有点私货？话说正则表达式这种东西没有一个统一的规范的吗？
- 数组默认都是定长数组，而我们写业务要用的动态数组是一个特定的类`List`
- 使用键值访问字典类对象的时候，总会提示“将字符串值转为hash值再使用”，也许提高了一丝丝性能，但是语法上好难受

### 4.工程性

- c#对命名也有规范，虽然不像Golang那样强制，但是通过语法检查标记波浪线，在我这种强迫症患者看来也跟强制差不多了。
  + 其中要求属性/方法首字母大写这一点尤其让我不舒服。（跟golang半斤八两）
  + 强制要求分号，这个细节极其惹人讨厌，我花费大量的精力去手动补全分号（比go/js差远了）
- 对了，左大括号默认另起一行这一点让我尤其尤其不舒服。我直接在Rider里配置改掉了这种格式化规则。
  + 还要改`catch` `finally` `else`这些关键字不要另起一行。
- 编译产物太多了（远远不及Golang的简洁）
- IDE的支持方面，Rider的支持力度似乎明显高于Pycharm和Goland？
- 像Java一样的虚拟机，原生支持热加载，使用感受上介于静态语言和动态语言之间，还是挺有趣的。

### 5.并发与高性能

- 涉及到指针的代码都是unsafe，
  + 罪魁祸首是因为支持指针运算，这个特性很糟糕。（其实还涉及GC设计）（go对于指针的设计就很让我喜欢）
  + 虽然有大佬已经实践了DOP（面向数据编程），但我目前依然对c#在这种编程思想下的表现很没有信心。
- 并发方面，首先看到的多线程是很传统的那一套，需要先实例化一个线程对象然后start之类的，非常的古老
- 有协程，`async/await`语法符合预期
  + 能够在后台线程中执行协程，轻松应对cpu密集型任务，这个好评（比不上go，但是比js方便）
  + `Task`与js中的`Promise`很相似，但是没有`resolve/reject`，也没有`then/catch/finally`（总之就是没搞函数式那套）

### 小结

总之就是喜忧参半，既有优秀的部分，也有很陈旧或者不稳定的部分。

在论坛中总是能看到有人吹c#，说它是一门虽然语言设计很优秀但是一直不火的语言。而我目前的看法是，只能说这门语言本身也不咋地，在我看来它只是融合了很多流行的特性、设置了很多语法糖去讨好开发者，也许得到不少人的簇拥，但从我的审美来看远远称不上完美。

目前我所掌握的语言的喜爱程度：ts > go > c# >> python

不过有一说一，如果目前要让我找一门能用于业务的、面向对象的语言，还真只有c#拿得出来。

虽然目前一个主流趋势是排斥OOP的，但不得不说以Java为代表的OOP思想依然在业内有重要的地位。后续，我会试着体验一下Java/Kotlin，做一下对比再下结论。

另外，DOP这种编程思想其实不止一种思想，目前也已经有了不少最佳实践，后续我也会认真研究一下。[参考](https://www.cnblogs.com/KillerAery/p/11746639.html)

## unity体验

首先官网充满了商业化气息，注册一个账号走了好几分钟的流程，服了。

然后先下载的是一个叫做hub的项目管理工具，安装后打开后再安装unity编辑器。（第一次默认安装流程还安装失败了，我卸载后重新安装）

新建一个项目，新建的过程居然用了四五分钟。

个人开发者做游戏的一个最大痛点应该就是美术资源了吧，在Unity里很成熟，去 [官方商店](https://assetstore.unity.com/) 里找，有很多免费的资源，点击获取然后在软件里导入美术素材(assets)就可以使用了。

项目文件管理方面，作为程序员我唯一的选择自然是git，不过Unity这种软件是把项目所有资源都放在一个目录里，要认真配置的话细节还是很多的。幸运的是果然已经有大佬分享了关于git的实践，[参考](https://thoughtbot.com/blog/how-to-git-with-unity)

在操作过程中感觉，软件的交互设置得很优秀，很多东西都能可视化地编辑，痛点很少。（虽然我这里每次用了几个小时之后就会报错然后崩溃，瑕不掩瑜）

## 成果与总结

一周的时间里，我大约花了10个小时学习c#基本语法，然后花了20个小时边学Unity边做游戏（[视频教程](https://www.bilibili.com/video/BV1A441167MF)），总共30多个小时的时间，成果如下：

![试做游戏](../pic/2022/220321-Unity-game.gif)

自信地说，由于我已经有了多语言、全栈、游戏、甚至美术方面的经验，所以我这个学习速度绝对是非常非常快的了。如果以一个普通前端工程师的水平估计，2-6周内达到这个水平（有自己的思想去做出来，而不是照着教程抄）应该是差不多的。

所以可以认为，`c#`+`Unity`的学习门槛并不高，学完之后应用领域也很广，真的非常值得一学。
